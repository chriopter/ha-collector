blueprint:
  name: Hue Tap Dial Switch
  description: Steuere Lichter mit dem Hue Tap Dial - 4 Tasten für Szenen, Dial für Helligkeit
  domain: automation
  input:
    tap_dial:
      name: Tap Dial Device
      description: Der Hue Tap Dial Switch
      selector:
        device:
          integration: hue
          model: RDM002
    target_light:
      name: Ziel-Licht
      description: Das Licht das gesteuert werden soll
      selector:
        entity:
          domain: light
    button_1_scene:
      name: Taste 1 - Szene
      description: Szene für Taste 1
      selector:
        entity:
          domain: scene
    button_2_scene:
      name: Taste 2 - Szene
      description: Szene für Taste 2
      selector:
        entity:
          domain: scene
    button_3_scene:
      name: Taste 3 - Szene
      description: Szene für Taste 3
      selector:
        entity:
          domain: scene
    button_4_scene:
      name: Taste 4 - Szene
      description: Szene für Taste 4 (oder Aus)
      selector:
        entity:
          domain: scene
    brightness_step:
      name: Helligkeits-Schritt
      description: Wie viel Prozent pro Drehung
      default: 10
      selector:
        number:
          min: 5
          max: 25
          step: 5

mode: restart
max_exceeded: silent

trigger:
  - platform: device
    device_id: !input tap_dial
    domain: hue
    type: short_release
    subtype: 1
    id: button_1
  - platform: device
    device_id: !input tap_dial
    domain: hue
    type: short_release
    subtype: 2
    id: button_2
  - platform: device
    device_id: !input tap_dial
    domain: hue
    type: short_release
    subtype: 3
    id: button_3
  - platform: device
    device_id: !input tap_dial
    domain: hue
    type: short_release
    subtype: 4
    id: button_4
  - platform: device
    device_id: !input tap_dial
    domain: hue
    type: clock_wise
    id: dial_cw
  - platform: device
    device_id: !input tap_dial
    domain: hue
    type: counter_clock_wise
    id: dial_ccw

action:
  - choose:
      - conditions:
          - condition: trigger
            id: button_1
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input button_1_scene
      - conditions:
          - condition: trigger
            id: button_2
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input button_2_scene
      - conditions:
          - condition: trigger
            id: button_3
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input button_3_scene
      - conditions:
          - condition: trigger
            id: button_4
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input button_4_scene
      - conditions:
          - condition: trigger
            id: dial_cw
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input target_light
            data:
              brightness_step_pct: !input brightness_step
      - conditions:
          - condition: trigger
            id: dial_ccw
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input target_light
            data:
              brightness_step_pct: "{{ -1 * brightness_step }}"
